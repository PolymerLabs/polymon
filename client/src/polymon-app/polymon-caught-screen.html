<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="polymon-styles.html">
<link rel="import" href="polymon-portrait.html">
<link rel="import" href="polymon-element.html">
<link rel="import" href="polymon-button.html">

<dom-module id="polymon-caught-screen">
  <template>
    <style include="rotate-animation wiggle-animation">
      :host {
        @apply --layout-fit;
        @apply --layout-vertical;

        font-family: var(--polymon-font-family);
        text-align: center;
        background-image: linear-gradient(25deg, #71D3F4, #DEF6FF);

        opacity: 0;
        pointer-events: none;
        transform: translateY(10px);
        transition: transform 0.3s, opacity 0.15s;

        box-sizing: border-box;
        padding: 1em;

        justify-content: space-between;

        --polymon-portrait-background: transparent;
      }

      a {
        -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);
      }

      h1 {
        color: #F43865;
        text-shadow: 0 1px 0 #a31733;
      }

      :host([active]) {
        opacity: 1;
        pointer-events: all;
        transform: translateY(0);
      }

      #container {
        position: relative;
      }

      #container polymon-portrait {
        position: relative;
        margin: auto;
        z-index: 1;
        animation: wiggle 2s;
        animation-iteration-count: infinite;
      }

      #container:after {
        content: '';
        position: absolute;
        top: 20px;
        left: calc(50% - 100px);
        width: 200px;
        height: 200px;
        background-color: #71D3F4;
        border-radius: 100px;
      }

      #container > div {
        position: absolute;
        animation-name: rotate;
        animation-duration: 10s;
        animation-iteration-count: infinite;
        animation-timing-function: linear;
      }

      #container > div#one {
        width: 260px;
        height: 260px;
        top: 0px;
        left: calc(50% - 130px);
        border-left: 15px solid #71D3F4;
        border-radius: 130px;
      }

      #container > div#one {
        width: 260px;
        height: 260px;
        top: 0px;
        left: calc(50% - 130px);
        border-left: 15px solid #71D3F4;
        border-radius: 130px;
      }

      #container > div#two {
        width: 280px;
        height: 280px;
        top: -20px;
        left: calc(50% - 160px);
        border-left: 10px solid #71D3F4;
        border-radius: 140px;
        animation-duration: 9s;
        animation-delay: -4s;
        animation-direction: reverse;
      }

      #container > div#three {
        width: 270px;
        height: 270px;
        top: -10px;
        left: calc(50% - 140px);
        border-left: 20px solid #71D3F4;
        border-radius: 135px;
        animation-duration: 12s;
        animation-delay: -7s;
      }

      #container > div#four {
        width: 260px;
        height: 260px;
        top: 10px;
        left: calc(50% - 120px);
        border-left: 15px solid #71D3F4;
        border-radius: 130px;
        animation-delay: -2s;
        animation-direction: reverse;
      }

      #overlay {
        @apply --layout-vertical;
        @apply --layout-end-justified;
      }

      #continue {
        width: 100%;
      }

      firebase-document {
        display: none;
      }

    </style>
    <firebase-document
        app-name="polymon"
        path="[[__caughtPolymonPath(data.polymonId)]]"
        data="{{polymon}}">
    </firebase-document>
    <h1>You caught a [[polymon.shortName]] Polymon!</h1>
    <section id="container">
      <polymon-portrait
          size="250"
          polymon="[[polymon]]"
          caught>
      </polymon-portrait>
      <div id="one"></div>
      <div id="two"></div>
      <div id="three"></div>
      <div id="four"></div>
    </section>

    <section id="overlay">
      <a href="[[continueTo]]">
        <polymon-button id="continue" class="alt">Continue</polymon-button>
      </a>
    </section>
  </template>
  <script>
    Polymer({
      is: 'polymon-caught-screen',

      behaviors: [PolymonElement],

      properties: {
        active: {
          type: Boolean,
          reflectToAttribute: true,
          value: false
        },

        data: {
          type: Object,
          notify: true
        },

        continueTo: {
          type: String,
          value: '/'
        }
      },

      __caughtPolymonPath: function(polymonId) {
        if (polymonId) {
          return `/polymons/${polymonId}`;
        }
      }
    });
  </script>
</dom-module>
