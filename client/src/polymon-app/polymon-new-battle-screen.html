<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="polymon-styles.html">
<link rel="import" href="polymon-element.html">
<link rel="import" href="polymon-button.html">
<link rel="import" href="polymon-portrait.html">
<link rel="import" href="polymon-qr-code-scanner-proxy.html">

<dom-module id="polymon-new-battle-screen">
  <template>
    <style>
      :host {
        position: relative;

        position: relative;
        box-sizing: border-box;
        padding: 8px;

        @apply --layout-vertical;
        align-items: stretch;

        text-align: center;
        overflow: hidden;
      }

      #team {
        flex: 1;
        @apply --layout-vertical;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      #team .hidden {
        display: none;
      }

      #controls {
        @apply --layout-vertical;
        flex: 0 0 auto;
      }

      #controls a {
        -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);
      }

      #controls > a  {
        width: 100%;
      }

      .bottom-row {
        @apply --layout-horizontal;
      }

      .bottom-row > :first-child {
        flex: 0;
      }

      .bottom-row > :last-child {
        flex: 1;
        /*margin-left: 8px;*/
      }

      polymon-button {
        width: 100%;
        margin-top: 8px;
      }

      #team {
        color: rgba(0, 0, 0, 0.8);
      }

      h1 {
        font-family: 'Bungee Inline', sans-serif;
        font-weight: normal;
        font-size: 40px;
        margin: 16px 0;
      }

      p {
        font-family: sans-serif;
        font-size: 18px;
        margin: 0 0 18px;
      }

      h2 {
        font-weight: normal;
        margin: 8px 0;
      }

      ul {
        text-align: left;
        margin: 0;
        margin-bottom: 18px;
        padding-left: 24px;
        font-family: sans-serif;
        font-size: 18px;
      }

      .strong {
        font-weight: bold;
      }
    </style>

    <app-route
        pattern="/scan"
        route="{{route}}"
        active="{{scanRouteActive}}">
    </app-route>

    <polymon-qr-code-scanner-proxy
        active="[[scanRouteActive]]"
        return-to="[[route.prefix]]">
    </polymon-qr-code-scanner-proxy>

    <section id="team">
      <h1>How to battle</h1>
      <p>So you've caught 3-5 Polymon and you're ready to get out there and start battling. Follow these instructions and you'll be sure to become a Polymon Master in no time!</p>

      <h2>The Basics</h2>
      <ul>
        <li>Select one of <span class="strong">ATTACK</span>, <span class="strong">FOCUS</span>, or <span class="strong">COUNTER</span></li>
        <li>When you tap one of the Action buttons, a drawer will slide up revealing all of your remaining Polymon and their respective statistics for that Action.</li>
        <li>Select a Polymon to lock in your move for the round.</li>
        <li>When both you and your opponent have submitted your moves, an animation will play showing the results of the round.</li>
        <li>After the round, the Polymon that just battled will disappear from each player's team.</li>
        <li>This rock, paper, scissors-style battle repeats until at least one player has run out of Polymon.</li>
      </ul>

      <h2>The Rules</h2>
      <ul>
        <li><span class="strong">ATTACK</span>, <span class="strong">FOCUS</span>, and <span class="strong">COUNTER</span> are analogous to rock, paper, scissors.</li>
        <li><span class="strong">ATTACK</span> has a 3 point advantage over <span class="strong">FOCUS</span></li>
        <li><span class="strong">FOCUS</span> has a 3 point advantage over <span class="strong">COUNTER</span></li>
        <li><span class="strong">COUNTER</span> has a 3 point advantage over <span class="strong">ATTACK</span></li>
      </ul>

      <p>When the battle starts, you will see your own team on the grassy platform in the foreground, and your opponent's team in the background. You can click the "Opponent Stats" button to snoop on the strength of your opponent's Polymon.</p>

      <!-- <template is="dom-repeat" items="[[teamPolymons]]" as="polymons">
        <div class="entry [[__entryClass(polymon)]]">
          <polymon-portrait polymon="[[polymon]]"></polymon-portrait>
        </div>
      </template> -->
    </section>

    <section id="controls">
      <a id="join" href="/battle/new/scan">
        <polymon-button>Join a Friend</polymon-button>
      </a>
      <a id="start" on-tap="__onStartTap">
        <polymon-button>Start a Battle</polymon-button>
      </a>
      <div class="bottom-row">
        <a href="/polydex">
          <polymon-button class="alt">Back</polymon-button>
        </a>
        <!-- <a href="javascript:void(0)">
          <polymon-button class="help">Tutorial</polymon-button>
        </a> -->
      </div>
    </section>

  </template>
  <script>
    Polymer({
      is: 'polymon-new-battle-screen',

      behaviors: [PolymonElement],

      properties: {
        teamPolymons: {
          type: Array
        }
      },

      __onStartTap: function() {
        if (this.user) {
          firebase.app('polymon').database()
              .ref(`/users/${this.user.uid}/battleQueue`).push({
                action: 'initiate',
                createdAt: Date.now()
              });
        }
      },

      __entryClass(polymon) {
        return (polymon != null && polymon.polydexId != null)
            ? ''
            : 'empty';
      }
    });
  </script>
</dom-module>
