<script>
  (() => {
    /** @polymerBehavior */
    PolymonRenderableBehavior = {
      properties: {
        hidden: {
          type: Boolean,
          reflectToAttribute: true,
          observer: '__hiddenChanged'
        },

        hideDelay: {
          type: Number,
          value: 300
        },

        rendered: {
          type: Boolean,
          readOnly: true
        },

        __hidingTimeout: {
          type: Number
        }
      },

      attached: function() {
        this.fire('polymon-renderable-attached', { item: this });
      },

      /**
       * @abstract
       *
       * Renders the Element ([hidden] or not) and sets the value of rendered
       * (defaults to hidden). Override for element-specific rendering.
       *
       * @param {boolean=} shouldBeVisible whether or not the element should
       *    be visible. Defaults to false.
       * @returns {Promise<boolean>} whether or not the element should be visible. True
       *    if set `hidden` attribute. False if removed it.
       */
      render: function(shouldBeVisible) {
        if (this.__hidingTimeout) {
          this.cancelAsync(this.__hidingTimeout);
          this.__hidingTimeout = null;
        }

        if (shouldBeVisible) {
          this.hidden = false;
          this._setRendered(!this.hidden);
        } else {
          this.__hidingTimeout = this.async(() => {
            this.hidden = true;
            this._setRendered(!this.hidden);
          }, this.hideDelay);
        }

        return this.rendered;
      },

      __hiddenChanged: function() {
        this.render(!this.hidden);
      }
    };
  })();
</script>
