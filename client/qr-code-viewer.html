<!doctype html>
<html>
  <head>
    <title>polymon</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="/bower_components/polymer/polymer.html">
    <link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
    <link rel="import" href="/bower_components/app-location/app-location.html">
    <link rel="import" href="/bower_components/app-route/app-route.html">
    <link rel="import" href="/src/polymon-app/polymon-qr-code.html">
    <style>
      body {
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <dom-module id="qr-code-viewer">
      <template>
        <style>
          :host {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            font-family: sans-serif;
            justify-content: space-around;
          }

          a {
            display: flex;
            flex-direction: column;
            align-items: center;
          }
        </style>
        <iron-ajax
            url="/qr-code-data.json"
            handle-as="json"
            last-response="{{data}}"
            auto>
        </iron-ajax>

        <app-location route="{{route}}" use-hash-as-path hidden>
        </app-location>
        <app-route
            route="{{route}}"
            pattern="/polymon/:shortName"
            data="{{polymonSelection}}"
            active="{{polymonRouteActive}}"
            hidden>
        </app-route>

        <a hidden$="[[!polymonRouteActive]]">
          <polymon-qr-code
              size="7"
              margin="5"
              data="reference.[[selectedDatum.reference]]">
          </polymon-qr-code>
          <span>[[selectedDatum.polymon.shortName]]</span>
          <span>reference.[[selectedDatum.reference]]</span>
        </a>

        <template is="dom-repeat" items="[[data]]" as="datum">
          <a href="#/polymon/[[datum.polymon.shortName]]" hidden$="[[polymonRouteActive]]">
            <polymon-qr-code data="reference.[[datum.reference]]"></polymon-qr-code>
            <span>[[datum.polymon.shortName]]</span>
          </a>
        </template>
      </template>
      <script>
        Polymer({
          is: 'qr-code-viewer',

          properties: {
            data: {
              type: Array
            },

            selectedDatum: {
              type: Object,
              computed: '__computeSelectedDatum(data, polymonSelection.shortName)'
            }
          },

          __computeSelectedDatum: function(data, shortName) {
            for (var i = 0; i < data.length; ++i) {
              if (data[i].polymon.shortName === shortName) {
                return data[i];
              }
            }
          }
        });
      </script>
    </dom-module>
    <qr-code-viewer></qr-code-viewer>
  </body>
</html>
